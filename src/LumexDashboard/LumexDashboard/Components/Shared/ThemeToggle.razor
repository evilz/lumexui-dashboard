@inject IJSRuntime JS

<div class="relative">
    <button class="p-2 rounded-lg hover:bg-default-100 transition-colors flex items-center gap-1" 
            @onclick="ToggleTheme" 
            title="@GetTooltip()">
        @if (_isDarkMode)
        {
            <!-- Sun icon - click to switch to light -->
            <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
        }
        else
        {
            <!-- Moon icon - click to switch to dark -->
            <svg class="w-5 h-5 text-default-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
            </svg>
        }
    </button>
</div>

@code {
    private bool _isDarkMode = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var storedMode = await JS.InvokeAsync<string>("eval", "localStorage.getItem('themeMode') || 'light'");
            _isDarkMode = storedMode == "dark";
            await ApplyTheme();
            StateHasChanged();
        }
    }

    private string GetTooltip() => _isDarkMode ? "Switch to light mode" : "Switch to dark mode";

    private async Task ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
        var mode = _isDarkMode ? "dark" : "light";
        await JS.InvokeVoidAsync("eval", $"localStorage.setItem('themeMode', '{mode}')");
        await ApplyTheme();
    }

    private async Task ApplyTheme()
    {
        var mode = _isDarkMode ? "dark" : "light";
        await JS.InvokeVoidAsync("eval", $@"
            const html = document.documentElement;
            html.classList.remove('light', 'dark');
            html.classList.add('{mode}');
        ");
    }
}
