@page "/settings"
@using LumexUI
@using LumexUI.Common

<PageTitle>Settings</PageTitle>

<div class="space-y-6">
    <!-- Page Header -->
    <div>
        <h1 class="text-2xl font-bold text-foreground">Settings</h1>
        <p class="text-default-500 mt-1">Manage your account and application preferences</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Settings Navigation -->
        <div class="lg:col-span-1">
            <LumexCard>
                <LumexCardBody Class="p-2">
                    <nav class="space-y-1">
                        <button class="@GetNavClass(ProfileSection) w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left"
                                @onclick="@(() => SetActiveSection(ProfileSection))">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            <span class="font-medium">Profile</span>
                        </button>
                        <button class="@GetNavClass(SecuritySection) w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left"
                                @onclick="@(() => SetActiveSection(SecuritySection))">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                            <span class="font-medium">Security</span>
                        </button>
                        <button class="@GetNavClass(NotificationsSection) w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left"
                                @onclick="@(() => SetActiveSection(NotificationsSection))">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                            <span class="font-medium">Notifications</span>
                        </button>
                        <button class="@GetNavClass(AppearanceSection) w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left"
                                @onclick="@(() => SetActiveSection(AppearanceSection))">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                            <span class="font-medium">Appearance</span>
                        </button>
                        <button class="@GetNavClass(BillingSection) w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors text-left"
                                @onclick="@(() => SetActiveSection(BillingSection))">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                            <span class="font-medium">Billing</span>
                        </button>
                    </nav>
                </LumexCardBody>
            </LumexCard>
        </div>

        <!-- Settings Content -->
        <div class="lg:col-span-3 space-y-6">
            @if (_activeSection == ProfileSection)
            {
                <!-- Profile Settings -->
                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-6">Profile Information</h2>
                        
                        <div class="flex items-center gap-6 mb-8">
                            <LumexAvatar Name="@_profileData.FullName" Size="Size.Large" Class="w-20 h-20 text-2xl" />
                            <div>
                                <LumexButton Variant="Variant.Outlined" Size="Size.Small">Change Avatar</LumexButton>
                                <p class="text-xs text-default-500 mt-2">JPG, PNG or GIF. Max size 2MB</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">First Name</label>
                                <input type="text" @bind="_profileData.FirstName" placeholder="Enter first name" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">Last Name</label>
                                <input type="text" @bind="_profileData.LastName" placeholder="Enter last name" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">Email Address</label>
                                <input type="email" @bind="_profileData.Email" placeholder="Enter email" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">Phone Number</label>
                                <input type="tel" @bind="_profileData.Phone" placeholder="Enter phone number" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-default-700 mb-2">Bio</label>
                                <textarea @bind="_profileData.Bio" placeholder="Write a short bio..." rows="3" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground"></textarea>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-divider">
                            <LumexButton Variant="Variant.Outlined" Color="ThemeColor.Default">Cancel</LumexButton>
                            <LumexButton Color="ThemeColor.Primary">Save Changes</LumexButton>
                        </div>
                    </LumexCardBody>
                </LumexCard>
            }
            else if (_activeSection == SecuritySection)
            {
                <!-- Security Settings -->
                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-6">Change Password</h2>
                        
                        <div class="space-y-4 max-w-md">
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">Current Password</label>
                                <input type="password" @bind="_securityData.CurrentPassword" placeholder="Enter current password" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">New Password</label>
                                <input type="password" @bind="_securityData.NewPassword" placeholder="Enter new password" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-2">Confirm New Password</label>
                                <input type="password" @bind="_securityData.ConfirmPassword" placeholder="Confirm new password" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-divider">
                            <LumexButton Color="ThemeColor.Primary">Update Password</LumexButton>
                        </div>
                    </LumexCardBody>
                </LumexCard>

                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-4">Two-Factor Authentication</h2>
                        <p class="text-sm text-default-500 mb-4">Add an extra layer of security to your account</p>
                        
                        <div class="flex items-center justify-between p-4 bg-default-100 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-success/20 rounded-full flex items-center justify-center">
                                    <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-foreground">Authenticator App</p>
                                    <p class="text-xs text-default-500">Use an authenticator app to generate codes</p>
                                </div>
                            </div>
                            <LumexSwitch @bind-Value="_securityData.TwoFactorEnabled" Color="ThemeColor.Success" />
                        </div>
                    </LumexCardBody>
                </LumexCard>
            }
            else if (_activeSection == NotificationsSection)
            {
                <!-- Notification Settings -->
                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-6">Notification Preferences</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-sm font-semibold text-foreground mb-4">Email Notifications</h3>
                                <div class="space-y-3">
                                    @foreach (var setting in _notificationSettings.Where(s => s.Category == EmailCategory))
                                    {
                                        <div class="flex items-center justify-between p-3 bg-default-50 rounded-lg">
                                            <div>
                                                <p class="text-sm font-medium text-foreground">@setting.Title</p>
                                                <p class="text-xs text-default-500">@setting.Description</p>
                                            </div>
                                            <LumexSwitch @bind-Value="setting.Enabled" Color="ThemeColor.Primary" />
                                        </div>
                                    }
                                </div>
                            </div>

                            <div>
                                <h3 class="text-sm font-semibold text-foreground mb-4">Push Notifications</h3>
                                <div class="space-y-3">
                                    @foreach (var setting in _notificationSettings.Where(s => s.Category == PushCategory))
                                    {
                                        <div class="flex items-center justify-between p-3 bg-default-50 rounded-lg">
                                            <div>
                                                <p class="text-sm font-medium text-foreground">@setting.Title</p>
                                                <p class="text-xs text-default-500">@setting.Description</p>
                                            </div>
                                            <LumexSwitch @bind-Value="setting.Enabled" Color="ThemeColor.Primary" />
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-divider">
                            <LumexButton Variant="Variant.Outlined" Color="ThemeColor.Default">Reset to Default</LumexButton>
                            <LumexButton Color="ThemeColor.Primary">Save Preferences</LumexButton>
                        </div>
                    </LumexCardBody>
                </LumexCard>
            }
            else if (_activeSection == AppearanceSection)
            {
                <!-- Appearance Settings -->
                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-6">Appearance</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-3">Theme</label>
                                <div class="grid grid-cols-3 gap-4">
                                    <button class="@(_appearanceData.Theme == LightTheme ? "ring-2 ring-primary" : "") p-4 bg-white border border-default-200 rounded-xl flex flex-col items-center gap-2"
                                            @onclick="@(() => _appearanceData.Theme = LightTheme)">
                                        <div class="w-16 h-10 bg-default-100 rounded-lg border border-default-200"></div>
                                        <span class="text-sm text-default-700">Light</span>
                                    </button>
                                    <button class="@(_appearanceData.Theme == DarkTheme ? "ring-2 ring-primary" : "") p-4 bg-default-900 border border-default-700 rounded-xl flex flex-col items-center gap-2"
                                            @onclick="@(() => _appearanceData.Theme = DarkTheme)">
                                        <div class="w-16 h-10 bg-default-800 rounded-lg border border-default-700"></div>
                                        <span class="text-sm text-default-100">Dark</span>
                                    </button>
                                    <button class="@(_appearanceData.Theme == SystemTheme ? "ring-2 ring-primary" : "") p-4 bg-gradient-to-r from-white to-default-900 border border-default-300 rounded-xl flex flex-col items-center gap-2"
                                            @onclick="@(() => _appearanceData.Theme = SystemTheme)">
                                        <div class="w-16 h-10 bg-gradient-to-r from-default-100 to-default-800 rounded-lg"></div>
                                        <span class="text-sm text-default-600">System</span>
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-default-700 mb-3">Accent Color</label>
                                <div class="flex gap-3">
                                    <button class="@(_appearanceData.AccentColor == PrimaryColor ? "ring-2 ring-offset-2" : "") w-8 h-8 rounded-full bg-primary"
                                            @onclick="@(() => _appearanceData.AccentColor = PrimaryColor)"></button>
                                    <button class="@(_appearanceData.AccentColor == SecondaryColor ? "ring-2 ring-offset-2" : "") w-8 h-8 rounded-full bg-secondary"
                                            @onclick="@(() => _appearanceData.AccentColor = SecondaryColor)"></button>
                                    <button class="@(_appearanceData.AccentColor == SuccessColor ? "ring-2 ring-offset-2" : "") w-8 h-8 rounded-full bg-success"
                                            @onclick="@(() => _appearanceData.AccentColor = SuccessColor)"></button>
                                    <button class="@(_appearanceData.AccentColor == WarningColor ? "ring-2 ring-offset-2" : "") w-8 h-8 rounded-full bg-warning"
                                            @onclick="@(() => _appearanceData.AccentColor = WarningColor)"></button>
                                    <button class="@(_appearanceData.AccentColor == DangerColor ? "ring-2 ring-offset-2" : "") w-8 h-8 rounded-full bg-danger"
                                            @onclick="@(() => _appearanceData.AccentColor = DangerColor)"></button>
                                </div>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-foreground">Compact Mode</p>
                                    <p class="text-xs text-default-500">Reduce spacing for a more compact layout</p>
                                </div>
                                <LumexSwitch @bind-Value="_appearanceData.CompactMode" Color="ThemeColor.Primary" />
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-divider">
                            <LumexButton Variant="Variant.Outlined" Color="ThemeColor.Default">Reset to Default</LumexButton>
                            <LumexButton Color="ThemeColor.Primary">Save Changes</LumexButton>
                        </div>
                    </LumexCardBody>
                </LumexCard>
            }
            else if (_activeSection == BillingSection)
            {
                <!-- Billing Settings -->
                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-lg font-semibold text-foreground">Current Plan</h2>
                                <p class="text-sm text-default-500">You are currently on the Pro plan</p>
                            </div>
                            <LumexChip Color="ThemeColor.Primary" Variant="ChipVariant.Flat">Pro Plan</LumexChip>
                        </div>
                        
                        <div class="bg-primary/5 border border-primary/20 rounded-xl p-6 mb-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-2xl font-bold text-foreground">$29<span class="text-sm font-normal text-default-500">/month</span></p>
                                    <p class="text-sm text-default-500 mt-1">Billed monthly Â· Next billing date: Dec 28, 2024</p>
                                </div>
                                <LumexButton Variant="Variant.Outlined" Color="ThemeColor.Primary">Upgrade Plan</LumexButton>
                            </div>
                        </div>

                        <h3 class="text-sm font-semibold text-foreground mb-4">Payment Method</h3>
                        <div class="flex items-center justify-between p-4 bg-default-50 rounded-lg mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-6 bg-default-200 rounded flex items-center justify-center text-xs font-bold">
                                    VISA
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-foreground">Visa ending in 4242</p>
                                    <p class="text-xs text-default-500">Expires 12/2026</p>
                                </div>
                            </div>
                            <LumexButton Variant="Variant.Light" Size="Size.Small">Edit</LumexButton>
                        </div>

                        <LumexButton Variant="Variant.Outlined" Size="Size.Small">+ Add Payment Method</LumexButton>
                    </LumexCardBody>
                </LumexCard>

                <LumexCard>
                    <LumexCardBody Class="p-6">
                        <h2 class="text-lg font-semibold text-foreground mb-4">Billing History</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-divider">
                                        <th class="text-left text-xs font-semibold text-default-500 pb-3">Date</th>
                                        <th class="text-left text-xs font-semibold text-default-500 pb-3">Description</th>
                                        <th class="text-left text-xs font-semibold text-default-500 pb-3">Amount</th>
                                        <th class="text-left text-xs font-semibold text-default-500 pb-3">Status</th>
                                        <th class="text-left text-xs font-semibold text-default-500 pb-3"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var invoice in _billingHistory)
                                    {
                                        <tr class="border-b border-default-100 last:border-0">
                                            <td class="py-3 text-sm text-default-500">@invoice.Date</td>
                                            <td class="py-3 text-sm text-foreground">@invoice.Description</td>
                                            <td class="py-3 text-sm font-medium text-foreground">@invoice.Amount</td>
                                            <td class="py-3">
                                                <LumexChip Size="Size.Small" Color="ThemeColor.Success" Variant="ChipVariant.Flat">@invoice.Status</LumexChip>
                                            </td>
                                            <td class="py-3">
                                                <LumexButton Variant="Variant.Light" Size="Size.Small">Download</LumexButton>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </LumexCardBody>
                </LumexCard>
            }
        </div>
    </div>
</div>

@code {
    // Section constants
    private const string ProfileSection = "profile";
    private const string SecuritySection = "security";
    private const string NotificationsSection = "notifications";
    private const string AppearanceSection = "appearance";
    private const string BillingSection = "billing";
    
    // Category constants
    private const string EmailCategory = "email";
    private const string PushCategory = "push";
    
    // Theme constants
    private const string LightTheme = "light";
    private const string DarkTheme = "dark";
    private const string SystemTheme = "system";
    
    // Color constants
    private const string PrimaryColor = "primary";
    private const string SecondaryColor = "secondary";
    private const string SuccessColor = "success";
    private const string WarningColor = "warning";
    private const string DangerColor = "danger";

    private string _activeSection = ProfileSection;
    
    private ProfileData _profileData = new()
    {
        FirstName = "John",
        LastName = "Doe",
        Email = "john.doe@example.com",
        Phone = "+1 (555) 123-4567",
        Bio = "Software developer passionate about building great products."
    };

    private SecurityData _securityData = new();

    private List<NotificationSetting> _notificationSettings = new()
    {
        new(EmailCategory, "Marketing emails", "Receive emails about new products, features, and more", true),
        new(EmailCategory, "Security alerts", "Get notified about security-related issues", true),
        new(EmailCategory, "Weekly digest", "Weekly summary of your account activity", false),
        new(PushCategory, "New messages", "Get notified when you receive a new message", true),
        new(PushCategory, "Payment alerts", "Notifications about payments and transactions", true),
        new(PushCategory, "Updates & announcements", "Product updates and company announcements", false)
    };

    private AppearanceData _appearanceData = new()
    {
        Theme = SystemTheme,
        AccentColor = PrimaryColor,
        CompactMode = false
    };

    private List<BillingHistoryItem> _billingHistory = new()
    {
        new("Nov 28, 2024", "Pro Plan - Monthly", "$29.00", "Paid"),
        new("Oct 28, 2024", "Pro Plan - Monthly", "$29.00", "Paid"),
        new("Sep 28, 2024", "Pro Plan - Monthly", "$29.00", "Paid"),
        new("Aug 28, 2024", "Pro Plan - Monthly", "$29.00", "Paid")
    };

    private void SetActiveSection(string sectionId)
    {
        _activeSection = sectionId;
    }

    private string GetNavClass(string sectionId) =>
        _activeSection == sectionId
            ? "bg-primary/10 text-primary"
            : "text-default-500 hover:bg-default-100";
    
    private class ProfileData
    {
        public string FirstName { get; set; } = "";
        public string LastName { get; set; } = "";
        public string Email { get; set; } = "";
        public string Phone { get; set; } = "";
        public string Bio { get; set; } = "";
        public string FullName => $"{FirstName} {LastName}";
    }

    private class SecurityData
    {
        public string CurrentPassword { get; set; } = "";
        public string NewPassword { get; set; } = "";
        public string ConfirmPassword { get; set; } = "";
        public bool TwoFactorEnabled { get; set; } = false;
    }

    private class NotificationSetting
    {
        public string Category { get; set; }
        public string Title { get; set; }
        public string Description { get; set; }
        public bool Enabled { get; set; }

        public NotificationSetting(string category, string title, string description, bool enabled)
        {
            Category = category;
            Title = title;
            Description = description;
            Enabled = enabled;
        }
    }

    private class AppearanceData
    {
        public string Theme { get; set; } = "";
        public string AccentColor { get; set; } = "";
        public bool CompactMode { get; set; }
    }

    private record BillingHistoryItem(string Date, string Description, string Amount, string Status);
}
