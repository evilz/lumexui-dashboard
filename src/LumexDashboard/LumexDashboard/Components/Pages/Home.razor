@page "/"
@using LumexUI
@using LumexUI.Common
@inject AppStateService AppState
@inject ToastService Toast

<PageTitle>Dashboard</PageTitle>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Move Goal Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-6">
                <div class="flex justify-between">
                    <div class="flex flex-col gap-1">
                        <span class="text-default-900 text-xl font-semibold">Move Goal</span>
                        <span class="text-default-500 text-sm">Set a daily goal</span>
                    </div>
                    <LumexButton Variant="Variant.Outlined" Size="Size.Small" OnClick="SetNewGoal">Set Goal</LumexButton>
                </div>
                <!-- Chart placeholder for radial bar -->
                <div class="flex justify-center items-center py-8">
                    <div class="relative w-40 h-40">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="8" class="text-default-200" />
                            <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="8" stroke-dasharray="@(282.7 * 0.62) 282.7" stroke-linecap="round" transform="rotate(-90 50 50)" class="text-primary" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-3xl font-bold text-foreground">@_moveGoal</span>
                            <span class="text-sm text-default-500">/ @_moveGoalMax cal</span>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center gap-2">
                    <LumexButton Variant="Variant.Outlined" Size="Size.Small" OnClick="DecreaseGoal">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                        </svg>
                    </LumexButton>
                    <LumexButton Variant="Variant.Outlined" Size="Size.Small" OnClick="IncreaseGoal">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </LumexButton>
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Cookie Settings Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1">
                    <span class="text-default-900 text-lg font-semibold">Cookie Settings</span>
                    <span class="text-default-500 text-sm">Manage your cookie preferences</span>
                </div>
                <div class="flex flex-col gap-4">
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="text-default-900 text-sm font-medium">Strictly Necessary</span>
                            <span class="text-default-500 text-xs">Required for the site to function</span>
                        </div>
                        <LumexSwitch @bind-Value="_strictlyNecessary" Color="ThemeColor.Primary" Disabled="true" />
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="text-default-900 text-sm font-medium">Functional Cookies</span>
                            <span class="text-default-500 text-xs">Enable personalized features</span>
                        </div>
                        <LumexSwitch @bind-Value="_functionalCookies" Color="ThemeColor.Primary" />
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="text-default-900 text-sm font-medium">Performance Cookies</span>
                            <span class="text-default-500 text-xs">Help improve our website</span>
                        </div>
                        <LumexSwitch @bind-Value="_performanceCookies" Color="ThemeColor.Primary" />
                    </div>
                </div>
                <LumexButton Color="ThemeColor.Primary" Class="w-full" OnClick="SaveCookiePreferences">Save Preferences</LumexButton>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Chat Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex items-center gap-3">
                    <LumexAvatar Name="Sofia Davis" />
                    <div class="flex flex-col">
                        <span class="text-default-900 font-medium">Sofia Davis</span>
                        <span class="text-default-500 text-sm">m@example.com</span>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <div class="flex justify-start">
                        <div class="bg-default-100 rounded-2xl rounded-bl-none px-4 py-2 max-w-[80%]">
                            <p class="text-sm text-foreground">Hi, how can I help you today?</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <div class="bg-primary text-white rounded-2xl rounded-br-none px-4 py-2 max-w-[80%]">
                            <p class="text-sm">Hey, I'm having trouble with my account.</p>
                        </div>
                    </div>
                    <div class="flex justify-start">
                        <div class="bg-default-100 rounded-2xl rounded-bl-none px-4 py-2 max-w-[80%]">
                            <p class="text-sm text-foreground">What seems to be the problem?</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <div class="bg-primary text-white rounded-2xl rounded-br-none px-4 py-2 max-w-[80%]">
                            <p class="text-sm">I can't log in.</p>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="text" @bind="_chatMessage" placeholder="Type your message..." class="flex-1 px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                    <LumexButton Color="ThemeColor.Primary" Size="Size.Small" OnClick="SendMessage">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </LumexButton>
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Subscriptions Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1">
                    <span class="text-default-900 text-lg font-semibold">Subscriptions</span>
                    <span class="text-default-500 text-sm">Total subscribers growth</span>
                </div>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-bold text-foreground">+2,350</span>
                    <span class="text-sm text-success font-medium">+180.1%</span>
                </div>
                <!-- Area chart placeholder -->
                <div class="h-48 flex items-end gap-1">
                    @foreach (var height in _subscriptionChartData)
                    {
                        <div class="flex-1 bg-primary/20 rounded-t transition-all hover:bg-primary/30" style="height: @(height)%;"></div>
                    }
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Sign In Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1 text-center">
                    <span class="text-default-900 text-xl font-semibold">Create an account</span>
                    <span class="text-default-500 text-sm">Enter your email below to create your account</span>
                </div>
                <div class="flex gap-2">
                    <LumexButton Variant="Variant.Outlined" Class="flex-1" OnClick="SignInWithGithub">
                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        GitHub
                    </LumexButton>
                    <LumexButton Variant="Variant.Outlined" Class="flex-1" OnClick="SignInWithGoogle">
                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Google
                    </LumexButton>
                </div>
                <div class="flex items-center gap-4">
                    <LumexDivider Class="flex-1" />
                    <span class="text-default-500 text-xs uppercase">Or continue with</span>
                    <LumexDivider Class="flex-1" />
                </div>
                <div class="flex flex-col gap-3">
                    <input type="email" placeholder="name@example.com" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                    <input type="password" placeholder="Password" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                    <LumexButton Color="ThemeColor.Primary" Class="w-full" OnClick="CreateAccount">Create account</LumexButton>
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Payment Method Card -->
    <LumexCard Class="sm:row-span-2 hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1">
                    <span class="text-default-900 text-lg font-semibold">Payment Method</span>
                    <span class="text-default-500 text-sm">Add a new payment method to your account</span>
                </div>
                <div class="flex gap-2">
                    <button class="@GetPaymentMethodClass("card")" @onclick="@(() => _selectedPaymentMethod = "card")">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        <span class="text-sm font-medium">Card</span>
                    </button>
                    <button class="@GetPaymentMethodClass("paypal")" @onclick="@(() => _selectedPaymentMethod = "paypal")">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.93 4.778-4.005 7.201-9.138 7.201h-2.19a.563.563 0 0 0-.556.479l-1.187 7.527h-.506l-.24 1.516a.56.56 0 0 0 .554.647h3.882c.46 0 .85-.334.922-.788.06-.26.76-4.852.816-5.09a.932.932 0 0 1 .923-.788h.58c3.76 0 6.705-1.528 7.565-5.946.36-1.847.174-3.388-.777-4.471z"/>
                        </svg>
                        <span class="text-sm font-medium">PayPal</span>
                    </button>
                    <button class="@GetPaymentMethodClass("apple")" @onclick="@(() => _selectedPaymentMethod = "apple")">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                        </svg>
                        <span class="text-sm font-medium">Apple</span>
                    </button>
                </div>
                <div class="flex flex-col gap-3">
                    <div>
                        <label class="block text-sm font-medium text-default-700 mb-2">Name</label>
                        <input type="text" @bind="_cardName" placeholder="First Last" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-default-700 mb-2">Card number</label>
                        <input type="text" @bind="_cardNumber" placeholder="0000 0000 0000 0000" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="col-span-1">
                            <label class="block text-sm font-medium text-default-700 mb-2">Expires</label>
                            <select @bind="_cardExpiryMonth" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground">
                                <option value="">Month</option>
                                @for (int i = 1; i <= 12; i++)
                                {
                                    <option value="@i">@i.ToString("D2")</option>
                                }
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-medium text-default-700 mb-2">Year</label>
                            <select @bind="_cardExpiryYear" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground">
                                <option value="">Year</option>
                                @for (int i = 2024; i <= 2034; i++)
                                {
                                    <option value="@i">@i</option>
                                }
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-medium text-default-700 mb-2">CVC</label>
                            <input type="text" @bind="_cardCvc" placeholder="CVC" class="w-full px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                        </div>
                    </div>
                </div>
                <LumexButton Color="ThemeColor.Primary" Class="w-full" OnClick="ContinuePayment">Continue</LumexButton>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Device Usage Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex justify-between items-start">
                    <div class="flex flex-col gap-1">
                        <span class="text-default-900 text-lg font-semibold">Device Usage</span>
                        <span class="text-default-500 text-sm">January - June 2024</span>
                    </div>
                    <select @bind="_devicePeriod" class="px-3 py-1.5 text-sm bg-default-100 border border-divider rounded-lg text-foreground">
                        <option>Last 6 months</option>
                        <option>Last 3 months</option>
                        <option>Last month</option>
                    </select>
                </div>
                <!-- Donut chart placeholder -->
                <div class="flex justify-center items-center py-4">
                    <div class="relative w-32 h-32">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="20" stroke-dasharray="@(251.3 * 0.60) 251.3" stroke-dashoffset="0" class="text-primary" />
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="20" stroke-dasharray="@(251.3 * 0.25) 251.3" stroke-dashoffset="@(-251.3 * 0.60)" class="text-secondary" />
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="20" stroke-dasharray="@(251.3 * 0.15) 251.3" stroke-dashoffset="@(-251.3 * 0.85)" class="text-warning" />
                        </svg>
                    </div>
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-primary"></div>
                            <span class="text-sm text-default-700">Desktop</span>
                        </div>
                        <span class="text-sm font-medium text-foreground">60%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-secondary"></div>
                            <span class="text-sm text-default-700">Mobile</span>
                        </div>
                        <span class="text-sm font-medium text-foreground">25%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-warning"></div>
                            <span class="text-sm text-default-700">Tablet</span>
                        </div>
                        <span class="text-sm font-medium text-foreground">15%</span>
                    </div>
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Team Members Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1">
                    <span class="text-default-900 text-lg font-semibold">Team Members</span>
                    <span class="text-default-500 text-sm">Invite your team members to collaborate</span>
                </div>
                <div class="flex flex-col gap-3">
                    @foreach (var member in _teamMembers)
                    {
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <LumexAvatar Name="@member.Name" Size="Size.Small" />
                                <div class="flex flex-col">
                                    <span class="text-sm font-medium text-foreground">@member.Name</span>
                                    <span class="text-xs text-default-500">@member.Email</span>
                                </div>
                            </div>
                            <select class="px-3 py-1 text-xs bg-default-100 border border-divider rounded-lg text-foreground">
                                <option selected="@(member.Role == "Owner")">Owner</option>
                                <option selected="@(member.Role == "Member")">Member</option>
                                <option selected="@(member.Role == "Viewer")">Viewer</option>
                            </select>
                        </div>
                    }
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Share Document Card -->
    <LumexCard Class="hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-1">
                    <span class="text-default-900 text-lg font-semibold">Share this document</span>
                    <span class="text-default-500 text-sm">Anyone with the link can view this document</span>
                </div>
                <div class="flex gap-2">
                    <input type="text" value="https://example.com/link/to/document" readonly class="flex-1 px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground" />
                    <LumexButton Color="ThemeColor.Primary" Size="Size.Small" OnClick="CopyDocumentLink">Copy</LumexButton>
                </div>
                <div class="flex flex-col gap-1">
                    <span class="text-sm font-medium text-foreground">People with access</span>
                </div>
                <div class="flex flex-col gap-3">
                    @foreach (var access in _documentAccess)
                    {
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <LumexAvatar Name="@access.Name" Size="Size.Small" />
                                <div class="flex flex-col">
                                    <span class="text-sm font-medium text-foreground">@access.Name</span>
                                    <span class="text-xs text-default-500">@access.Email</span>
                                </div>
                            </div>
                            <select class="px-3 py-1 text-xs bg-default-100 border border-divider rounded-lg text-foreground">
                                <option selected="@(access.Permission == "Can edit")">Can edit</option>
                                <option selected="@(access.Permission == "Can view")">Can view</option>
                            </select>
                        </div>
                    }
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>

    <!-- Users Table Card -->
    <LumexCard Class="col-span-1 sm:col-span-2 lg:col-span-4 hover:shadow-lg transition-shadow">
        <LumexCardBody Class="p-4 sm:p-6">
            <div class="flex flex-col gap-4">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div class="flex flex-col gap-1">
                        <span class="text-default-900 text-lg font-semibold">Users</span>
                        <span class="text-default-500 text-sm">Manage your team members and their roles</span>
                    </div>
                    <div class="flex gap-2">
                        <div class="relative">
                            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-default-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <input type="text" @bind="_userSearchQuery" @bind:event="oninput" placeholder="Search users..." class="pl-10 pr-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground placeholder-default-400" />
                        </div>
                        <select @bind="_roleFilter" class="px-4 py-2 text-sm bg-default-100 border border-divider rounded-lg text-foreground">
                            <option value="all">All roles</option>
                            <option value="admin">Admin</option>
                            <option value="member">Member</option>
                            <option value="viewer">Viewer</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-divider">
                                <th class="text-left py-3 px-4">
                                    <LumexCheckbox @bind-Value="_selectAllUsers" />
                                </th>
                                <th class="text-left text-xs font-semibold text-default-500 uppercase tracking-wider py-3 px-4">User</th>
                                <th class="text-left text-xs font-semibold text-default-500 uppercase tracking-wider py-3 px-4">Role</th>
                                <th class="text-left text-xs font-semibold text-default-500 uppercase tracking-wider py-3 px-4">Status</th>
                                <th class="text-left text-xs font-semibold text-default-500 uppercase tracking-wider py-3 px-4">Last Active</th>
                                <th class="text-right text-xs font-semibold text-default-500 uppercase tracking-wider py-3 px-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in FilteredUsers)
                            {
                                <tr class="border-b border-default-100 hover:bg-default-50 transition-colors">
                                    <td class="py-3 px-4">
                                        <LumexCheckbox @bind-Value="user.Selected" />
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex items-center gap-3">
                                            <LumexAvatar Name="@user.Name" Size="Size.Small" />
                                            <div class="flex flex-col">
                                                <span class="text-sm font-medium text-foreground">@user.Name</span>
                                                <span class="text-xs text-default-500">@user.Email</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-3 px-4">
                                        <span class="text-sm text-default-700">@user.Role</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <LumexChip Size="Size.Small" Color="@GetStatusColor(user.Status)" Variant="ChipVariant.Flat">@user.Status</LumexChip>
                                    </td>
                                    <td class="py-3 px-4">
                                        <span class="text-sm text-default-500">@user.LastActive</span>
                                    </td>
                                    <td class="py-3 px-4 text-right">
                                        <LumexButton Variant="Variant.Light" Size="Size.Small" OnClick="@(() => EditUser(user.Name))">Edit</LumexButton>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-between pt-4 border-t border-divider">
                    <span class="text-sm text-default-500">Showing @FilteredUsers.Count() of @_users.Count users</span>
                    <div class="flex gap-2">
                        <LumexButton Variant="Variant.Outlined" Size="Size.Small" Disabled="true" OnClick="PreviousPage">Previous</LumexButton>
                        <LumexButton Variant="Variant.Outlined" Size="Size.Small" OnClick="NextPage">Next</LumexButton>
                    </div>
                </div>
            </div>
        </LumexCardBody>
    </LumexCard>
</div>

@code {
    [CascadingParameter]
    private MainLayout? Layout { get; set; }

    // Move Goal
    private int _moveGoal = 350;
    private int _moveGoalMax = 562;

    // Cookie Settings
    private bool _strictlyNecessary = true;
    private bool _functionalCookies = false;
    private bool _performanceCookies = true;

    // Chat
    private string _chatMessage = "";

    // Subscription chart data (heights in percentage)
    private int[] _subscriptionChartData = { 30, 45, 35, 50, 40, 60, 55, 70, 65, 80, 75, 90 };

    // Payment Method
    private string _selectedPaymentMethod = "card";
    private string _cardName = "";
    private string _cardNumber = "";
    private string _cardExpiryMonth = "";
    private string _cardExpiryYear = "";
    private string _cardCvc = "";

    // Device Usage
    private string _devicePeriod = "Last 6 months";

    // Team Members
    private List<TeamMember> _teamMembers = new()
    {
        new("Sofia Davis", "m@example.com", "Owner"),
        new("Jackson Lee", "p@example.com", "Member"),
        new("Isabella Nguyen", "i@example.com", "Member")
    };

    // Document Access
    private List<DocumentAccess> _documentAccess = new()
    {
        new("Olivia Martin", "m@example.com", "Can edit"),
        new("Isabella Nguyen", "i@example.com", "Can view"),
        new("Sofia Davis", "s@example.com", "Can view")
    };

    // Users Table
    private string _userSearchQuery = "";
    private string _roleFilter = "all";
    private bool _selectAllUsers = false;

    private List<UserData> _users = new()
    {
        new("Olivia Martin", "olivia@example.com", "Admin", "Active", "2 min ago"),
        new("Jackson Lee", "jackson@example.com", "Member", "Active", "5 min ago"),
        new("Isabella Nguyen", "isabella@example.com", "Member", "Inactive", "1 hour ago"),
        new("William Kim", "william@example.com", "Viewer", "Active", "30 min ago"),
        new("Sofia Davis", "sofia@example.com", "Admin", "Active", "Just now")
    };

    private IEnumerable<UserData> FilteredUsers => _users
        .Where(u => string.IsNullOrEmpty(_userSearchQuery) ||
                    u.Name.Contains(_userSearchQuery, StringComparison.OrdinalIgnoreCase) ||
                    u.Email.Contains(_userSearchQuery, StringComparison.OrdinalIgnoreCase))
        .Where(u => _roleFilter == "all" || u.Role.Equals(_roleFilter, StringComparison.OrdinalIgnoreCase));

    private void SetNewGoal()
    {
        _moveGoal = 400;
        Toast.Success("Goal Updated", new ToastModel { Description = "Your daily move goal has been set to 400 calories" });
    }

    private void DecreaseGoal()
    {
        if (_moveGoal > 100)
        {
            _moveGoal -= 50;
            Toast.Info("Goal Decreased", new ToastModel { Description = $"Move goal set to {_moveGoal} calories" });
        }
    }

    private void IncreaseGoal()
    {
        if (_moveGoal < _moveGoalMax)
        {
            _moveGoal += 50;
            Toast.Info("Goal Increased", new ToastModel { Description = $"Move goal set to {_moveGoal} calories" });
        }
    }

    private void SaveCookiePreferences()
    {
        Toast.Success("Preferences Saved", new ToastModel { Description = "Your cookie preferences have been updated" });
    }

    private void SendMessage()
    {
        if (!string.IsNullOrWhiteSpace(_chatMessage))
        {
            Toast.Success("Message Sent", new ToastModel { Description = "Your message has been delivered" });
            _chatMessage = "";
        }
        else
        {
            Toast.Warning("Empty Message", new ToastModel { Description = "Please type a message before sending" });
        }
    }

    private void SignInWithGithub()
    {
        Toast.Info("GitHub Sign In", new ToastModel { Description = "Redirecting to GitHub authentication..." });
    }

    private void SignInWithGoogle()
    {
        Toast.Info("Google Sign In", new ToastModel { Description = "Redirecting to Google authentication..." });
    }

    private void CreateAccount()
    {
        Toast.Success("Account Created", new ToastModel { Description = "Welcome! Your account has been created successfully" });
    }

    private void ContinuePayment()
    {
        if (string.IsNullOrEmpty(_cardNumber) || string.IsNullOrEmpty(_cardName))
        {
            Toast.Error("Invalid Details", new ToastModel { Description = "Please fill in all card details" });
        }
        else
        {
            Toast.Success("Payment Method Added", new ToastModel { Description = "Your payment method has been saved" });
        }
    }

    private void CopyDocumentLink()
    {
        Toast.Success("Link Copied", new ToastModel { Description = "Document link copied to clipboard" });
    }

    private void EditUser(string userName)
    {
        Toast.Info("Edit User", new ToastModel { Description = $"Opening editor for {userName}..." });
    }

    private void PreviousPage()
    {
        Toast.Info("Navigation", new ToastModel { Description = "Already on first page" });
    }

    private void NextPage()
    {
        Toast.Info("Navigation", new ToastModel { Description = "Loading next page..." });
    }

    private string GetPaymentMethodClass(string method)
    {
        var baseClass = "flex-1 flex flex-col items-center gap-2 p-4 border rounded-lg transition-colors";
        return _selectedPaymentMethod == method
            ? $"{baseClass} border-primary bg-primary/5 text-primary"
            : $"{baseClass} border-divider text-default-500 hover:border-primary hover:text-primary";
    }

    private ThemeColor GetStatusColor(string status) => status switch
    {
        "Active" => ThemeColor.Success,
        "Inactive" => ThemeColor.Warning,
        _ => ThemeColor.Default
    };

    private record TeamMember(string Name, string Email, string Role);
    private record DocumentAccess(string Name, string Email, string Permission);

    private class UserData
    {
        public string Name { get; set; }
        public string Email { get; set; }
        public string Role { get; set; }
        public string Status { get; set; }
        public string LastActive { get; set; }
        public bool Selected { get; set; }

        public UserData(string name, string email, string role, string status, string lastActive)
        {
            Name = name;
            Email = email;
            Role = role;
            Status = status;
            LastActive = lastActive;
            Selected = false;
        }
    }
}
