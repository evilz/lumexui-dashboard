@inherits LayoutComponentBase
@inject IJSRuntime JS
@inject AppStateService AppState
@inject ToastService Toast
@using LumexDashboard.Styles

<div class="@MainLayoutStyles.GetContainerStyles()">
    <!-- Sidebar -->
    <Sidebar IsOpen="_sidebarOpen" IsCollapsed="_sidebarCollapsed" />

    <!-- Overlay for mobile -->
    <MobileOverlay Visible="_sidebarOpen" OnClick="ToggleSidebar" ZIndex="20" />

    <!-- Main Content Area -->
    <div class="@MainLayoutStyles.GetContentAreaStyles()">
        <!-- Top Bar -->
        <TopBar SidebarCollapsed="_sidebarCollapsed"
                OnMobileMenuClick="ToggleSidebar"
                OnSidebarCollapseClick="ToggleSidebarCollapse"
                OnSearchClick="OpenCommandPalette" />

        <!-- Page Content -->
        <main class="@MainLayoutStyles.GetMainStyles()">
            @Body
        </main>
    </div>
</div>

<!-- Toaster -->
<Toaster Position="ToastPosition.BottomRight" RichColors="true" CloseButton="true" />

<!-- Command Palette -->
<CommandPalette @ref="_commandPalette" />

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

@code {
    private bool _sidebarOpen = false;
    private bool _sidebarCollapsed = false;
    private CommandPalette? _commandPalette;

    private void ToggleSidebar()
    {
        _sidebarOpen = !_sidebarOpen;
    }

    private void ToggleSidebarCollapse()
    {
        _sidebarCollapsed = !_sidebarCollapsed;
    }

    private void OpenCommandPalette()
    {
        _commandPalette?.Open();
    }

    // Public method to show toasts from anywhere
    public void ShowToast(string title, string message, string type = "info")
    {
        var data = new ToastModel { Description = message };
        switch (type.ToLower())
        {
            case "success":
                Toast.Success(title, data);
                break;
            case "error":
                Toast.Error(title, data);
                break;
            case "warning":
                Toast.Warning(title, data);
                break;
            default:
                Toast.Info(title, data);
                break;
        }
    }
}
